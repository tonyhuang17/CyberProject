graph TB
    A[User Creates Secret<br/>name, value, type, env]
    B[React Frontend<br/>Form state]
    C[Retrieve JWT<br/>from localStorage]
    D[POST /api/items<br/>+ Bearer token]
    E[API Route Handler]
    F[JWT Verification<br/>requireAuth middleware]
    G{Token Valid?}
    H[Extract User Info<br/>user.id, user.role]
    I[Create Secret Document<br/>+ ownerEmail<br/>⚠️ secretValue PLAINTEXT]
    J[(MongoDB<br/>Secrets Collection)]
    K[Response<br/>Success]
    L[Update UI<br/>Display new secret]
    
    A --> B
    B --> C
    C -->|JWT retrieved| D
    D --> E
    E --> F
    F --> G
    G -->|Yes| H
    G -->|No| M[401 Unauthorized]
    H --> I
    I -->|Insert document| J
    J -->|Stored in DB| K
    K --> L
    
    style C fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px
    style I fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px
    style J fill:#ff6b6b,stroke:#c92a2a,stroke-width:3px
    style M fill:#ffd43b
    
    N[❌ CRITICAL ISSUES]
    N -.->|No encryption| I
    N -.->|Plaintext storage| J
    N -.->|XSS risk| C